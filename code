import streamlit as st
import pandas as pd

api_url= "https://steamspy.com/api.php"
games = []

df = pd.read_excel('PATH')

st.dataframe(df)
def search_rec(arr,low,high,x,result=None):
    #algoritma search secara rekursif
    if result is None:
        result = []
    if high >= low:
        mid = (low + high) //2
        if arr[mid]['Discount (%)'] >= x:
            result.append(arr[mid])
        search_rec(arr,low,mid+1,x)
        search_rec(arr,mid-1,high,x)
    return result
    
def click_button2():
    st.session_state.clicked = True

st.header("Aplikasi diskon game")

option = st.selectbox('Select discount: ',('10%','20%','30%','40%','50%','60%','70%','80%','90%'))

if 'clicked' not in st.session_state:
    st.session_state.clicked = False
if st.session_state.clicked:
    #panggil search
    selected_discount = int(option.strip('%'))
    games_sorted = sorted(games, key=lambda g: g['Discount (%)'])
    filtered_games = search_rec(games_sorted, 0, len(games_sorted) - 1, selected_discount)
    if filtered_games:
        st.write("Hasil search dengan diskon ",option)
        filtered_df = pd.DataFrame(filtered_games)
        st.dataframe(filtered_df)
    else:
        st.warning("Tidak ditemukan")
    st.session_state.clicked = False
st.button('Search', on_click=click_button2)
