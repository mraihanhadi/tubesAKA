import streamlit as st
import requests
import pandas as pd

api_url= "https://steamspy.com/api.php"

def fetch_data():
    params = {'request': 'all'}
    response = requests.get(api_url, params=params)
    if response.status_code == 200:
        return response.json()
    else:
        st.error("Failed to fetch data from SteamSpy API.")
        return {}
def process_data(data):
    games = []
    for appid, details in data.items():
        games.append({
                "Name": details.get('name', 'Unknown'),
                "Price": float(details.get('price', 0))/100,
                "Discount (%)": details.get('discount', 0)
        })
            
    return pd.DataFrame(games)

data = fetch_data()

if data:
    processedData = process_data(data)
    if not processedData.empty:
        st.dataframe(processedData)
    else:
        st.warning("No discounted games found.")
else:
    st.error("No data available.")

st.header("Aplikasi diskon game")

option = st.selectbox('Select discount: ',('10%','20%','30%','40%','50%','60%','70%','80%','90%'))

if 'clicked' not in st.session_state:
    st.session_state.clicked = False

def click_button2():
    st.session_state.clicked = True

def search_rec():
    #algoritma search secara rekursif
    st.write("Hasil search dengan diskon ",option)
    st.session_state.clicked = False

if st.session_state.clicked:
    #panggil search
    search_rec()


st.button('Search', on_click=click_button2)
